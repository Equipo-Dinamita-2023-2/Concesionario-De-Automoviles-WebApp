{"ast":null,"code":"import'../estilos/login.css';import{useState,useEffect,useRef}from'react';import{useNavigate}from'react-router-dom';import{obtenerEmpleados}from'../api/empleado-api';import{obtenerReparaciones}from'../api/reparacion-api';import ReCAPTCHA from\"react-google-recaptcha\";import{useUsername}from'../componentes/username';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Login(){const{setAndSaveUsername}=useUsername();const navigate=useNavigate();const[username,setUsername]=useState('');const[password,setPassword]=useState('');const captcha=useRef(null);const[isLoginMode,setIsLoginMode]=useState(true);// Estado para rastrear el modo actual\nconst[credenciales,setCredenciales]=useState([]);const[codigos,setCodigos]=useState([]);const handleToggleMode=()=>{setIsLoginMode(prevMode=>!prevMode);};const handleAction=()=>{if(isLoginMode&&captcha.current.getValue()){const empleadoValido=credenciales.some(credencial=>credencial.correo===username&&credencial.contrasenha===password&&credencial.id_rol===1);const gerenteValido=credenciales.some(credencial=>credencial.correo===username&&credencial.contrasenha===password&&credencial.id_rol===3);const talleristaValido=credenciales.some(credencial=>credencial.correo===username&&credencial.contrasenha===password&&credencial.id_rol===2);if(empleadoValido){navigate('/inicio');}else if(gerenteValido){navigate('/gerente');}else if(talleristaValido){navigate('/tallerista');}else{alert('Intente de nuevo.');}}else if(!captcha.current.getValue()){alert('Porfavor resuelva la captcha');}else{const codigoClienteValido=codigos.some(codigo=>codigo.cod_cliente===username);if(codigoClienteValido){setAndSaveUsername(username);navigate('/progreso');}else{alert('Intente de nuevo.');}}};const onChange=()=>{if(captcha.current.getValue()){console.log('Captcha validada');}};useEffect(()=>{async function cargarEmpleado(){try{const empleados=await obtenerEmpleados();console.log(empleados);const credencialesEmpleado=empleados.map(empleado=>({correo:empleado.correo,contrasenha:empleado.contrasenha,id_rol:empleado.id_rol}));setCredenciales(credencialesEmpleado);console.log(credenciales);}catch(error){console.error(\"Error al cargar empleado:\",error);}}cargarEmpleado();},[credenciales]);useEffect(()=>{async function cargarCodigo(){try{const reparacion=await obtenerReparaciones();console.log(reparacion);const codigoCliente=reparacion.map(cliente=>({cod_cliente:cliente.cod_cliente}));setCodigos(codigoCliente);console.log(codigos);}catch(error){console.error(\"Error al cargar cliente:\",error);}}cargarCodigo();},[codigos]);return/*#__PURE__*/_jsx(\"section\",{className:\"section-login\",children:/*#__PURE__*/_jsx(\"div\",{className:\"contenedor-login\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"formulario\",children:[/*#__PURE__*/_jsxs(\"form\",{action:\"#\",children:[/*#__PURE__*/_jsx(\"h2\",{children:isLoginMode?'Iniciar Sesión':'Ingresar'}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-contenedor\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:username,onChange:e=>setUsername(e.target.value),required:true}),/*#__PURE__*/_jsx(\"label\",{children:isLoginMode?'Usuario':'Código'})]}),isLoginMode&&/*#__PURE__*/_jsxs(\"div\",{className:\"input-contenedor\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:password,onChange:e=>setPassword(e.target.value),required:true}),/*#__PURE__*/_jsx(\"label\",{children:\"Contrase\\xF1a\"})]}),isLoginMode&&/*#__PURE__*/_jsxs(\"div\",{className:\"recaptcha\",children:[/*#__PURE__*/_jsx(ReCAPTCHA,{ref:captcha,sitekey:\"6LeiQS8pAAAAABY4oS7SZCaTo22zrBqbcq-Idk-e\",onChange:onChange}),\",\"]}),isLoginMode&&/*#__PURE__*/_jsx(\"div\",{className:\"olvidar\",children:/*#__PURE__*/_jsx(\"a\",{href:\"#\",children:\"Olvid\\xE9 la contrase\\xF1a\"})})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"button\",{className:\"btnLogin\",onClick:handleAction,children:isLoginMode?'Iniciar sesión':'Acceder'})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"p\",{onClick:handleToggleMode,className:\"toggle-mode\",children:isLoginMode?'Soy cliente':'Soy empleado'})})]})})});}export default Login;","map":{"version":3,"names":["useState","useEffect","useRef","useNavigate","obtenerEmpleados","obtenerReparaciones","ReCAPTCHA","useUsername","jsx","_jsx","jsxs","_jsxs","Login","setAndSaveUsername","navigate","username","setUsername","password","setPassword","captcha","isLoginMode","setIsLoginMode","credenciales","setCredenciales","codigos","setCodigos","handleToggleMode","prevMode","handleAction","current","getValue","empleadoValido","some","credencial","correo","contrasenha","id_rol","gerenteValido","talleristaValido","alert","codigoClienteValido","codigo","cod_cliente","onChange","console","log","cargarEmpleado","empleados","credencialesEmpleado","map","empleado","error","cargarCodigo","reparacion","codigoCliente","cliente","className","children","action","type","value","e","target","required","ref","sitekey","href","onClick"],"sources":["/home/ihuntgore/Escritorio/github-repos/Concesionario-De-Automoviles-WebApp/pag-react/src/paginas/login.js"],"sourcesContent":["import '../estilos/login.css'\nimport { useState, useEffect, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { obtenerEmpleados } from '../api/empleado-api'\nimport { obtenerReparaciones } from '../api/reparacion-api';\nimport ReCAPTCHA from \"react-google-recaptcha\";\nimport { useUsername } from '../componentes/username';\n\nfunction Login() {\n    const { setAndSaveUsername } = useUsername();\n    const navigate = useNavigate();\n    const [username, setUsername] = useState('');\n    const [password, setPassword] = useState('');\n    const captcha = useRef(null);\n    const [isLoginMode, setIsLoginMode] = useState(true); // Estado para rastrear el modo actual\n    const [credenciales, setCredenciales] = useState([]);\n    const [codigos, setCodigos] = useState([]);\n    const handleToggleMode = () => {\n        setIsLoginMode((prevMode) => !prevMode);\n    };\n\nconst handleAction = () => {\n    if (isLoginMode && captcha.current.getValue()) {\n        const empleadoValido = credenciales.some(\n            (credencial) =>\n                credencial.correo === username &&\n                credencial.contrasenha === password &&\n                credencial.id_rol === 1\n        );\n\n        const gerenteValido = credenciales.some(\n            (credencial) =>\n                credencial.correo === username &&\n                credencial.contrasenha === password &&\n                credencial.id_rol === 3\n        );\n        \n        const talleristaValido = credenciales.some(\n            (credencial) =>\n                credencial.correo === username &&\n                credencial.contrasenha === password &&\n                credencial.id_rol === 2\n        );  \n\n        if (empleadoValido) {\n            navigate('/inicio');\n        } else if (gerenteValido) {\n            navigate('/gerente');\n        } else if(talleristaValido){\n            navigate('/tallerista')\n        }else {\n            alert('Intente de nuevo.');\n        }\n\n\n    }  else if (!captcha.current.getValue()) {\n        alert('Porfavor resuelva la captcha');\n    }\n    else {\n\n        const codigoClienteValido = codigos.some(\n            (codigo) =>\n                codigo.cod_cliente === username\n        );\n\n        if (codigoClienteValido) {\n            setAndSaveUsername(username);\n            navigate('/progreso');\n        } else {\n            alert('Intente de nuevo.');\n        }\n    }\n    };\n\n    const onChange = () => {\n        if (captcha.current.getValue()) {\n            console.log('Captcha validada');\n        }\n    };\n\n    useEffect(() => {\n        async function cargarEmpleado() {\n            try {\n                const empleados = await obtenerEmpleados();\n                console.log(empleados);\n                const credencialesEmpleado = empleados.map((empleado) => ({\n                    correo: empleado.correo,\n                    contrasenha: empleado.contrasenha,\n                    id_rol: empleado.id_rol\n                }));\n                setCredenciales(credencialesEmpleado);\n                console.log(credenciales);\n            } catch (error) {\n                console.error(\"Error al cargar empleado:\", error);\n            }\n        }\n        cargarEmpleado();\n    }, [credenciales]);\n\n    useEffect(() => {\n        async function cargarCodigo() {\n            try {\n                const reparacion = await obtenerReparaciones();\n                console.log(reparacion);\n                const codigoCliente = reparacion.map((cliente) => ({\n                    cod_cliente: cliente.cod_cliente\n                }));\n                setCodigos(codigoCliente);\n                console.log(codigos);\n            } catch (error) {\n                console.error(\"Error al cargar cliente:\", error);\n            }\n        }\n        cargarCodigo();\n    }, [codigos]);\n    \n    return (\n        <section className='section-login'>\n            <div className=\"contenedor-login\">\n                <div className=\"formulario\">\n                    <form action='#'>\n                        <h2>{isLoginMode ? 'Iniciar Sesión' : 'Ingresar'}</h2>\n                        <div className=\"input-contenedor\">\n                            <input\n                                type=\"text\"\n                                value={username}\n                                onChange={(e) => setUsername(e.target.value)}\n                                required\n                            />\n                            <label>{isLoginMode ? 'Usuario' : 'Código'}</label>\n                        </div>\n                        {isLoginMode && (\n                            <div className=\"input-contenedor\">\n                                <input\n                                    type=\"password\"\n                                    value={password}\n                                    onChange={(e) => setPassword(e.target.value)}\n                                    required\n                                />\n                                <label>Contraseña</label>\n                            </div>\n                        )}\n                        {isLoginMode && (\n                            <div className=\"recaptcha\">\n                                <ReCAPTCHA\n                                    ref={captcha}\n                                    sitekey=\"6LeiQS8pAAAAABY4oS7SZCaTo22zrBqbcq-Idk-e\"\n                                    onChange={onChange}\n                                />,\n                            </div>\n                        )}\n                        {isLoginMode && (\n                            <div className=\"olvidar\">\n                                <a href=\"#\">Olvidé la contraseña</a>\n                            </div>\n                        )}\n                    </form>\n                    <div>\n                        <button className='btnLogin' onClick={handleAction}>\n                            {isLoginMode ? 'Iniciar sesión' : 'Acceder'}\n                        </button>\n                    </div>\n                    <div>\n                        <p onClick={handleToggleMode} className=\"toggle-mode\">\n                            {isLoginMode ? 'Soy cliente' : 'Soy empleado'}\n                        </p>\n                    </div>\n                </div>\n            </div>\n        </section>\n    );\n}\n\nexport default Login;"],"mappings":"AAAA,MAAO,sBAAsB,CAC7B,OAASA,QAAQ,CAAEC,SAAS,CAAEC,MAAM,KAAQ,OAAO,CACnD,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,OAASC,gBAAgB,KAAQ,qBAAqB,CACtD,OAASC,mBAAmB,KAAQ,uBAAuB,CAC3D,MAAO,CAAAC,SAAS,KAAM,wBAAwB,CAC9C,OAASC,WAAW,KAAQ,yBAAyB,CAAC,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAEtD,QAAS,CAAAC,KAAKA,CAAA,CAAG,CACb,KAAM,CAAEC,kBAAmB,CAAC,CAAGN,WAAW,CAAC,CAAC,CAC5C,KAAM,CAAAO,QAAQ,CAAGX,WAAW,CAAC,CAAC,CAC9B,KAAM,CAACY,QAAQ,CAAEC,WAAW,CAAC,CAAGhB,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAACiB,QAAQ,CAAEC,WAAW,CAAC,CAAGlB,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAAAmB,OAAO,CAAGjB,MAAM,CAAC,IAAI,CAAC,CAC5B,KAAM,CAACkB,WAAW,CAAEC,cAAc,CAAC,CAAGrB,QAAQ,CAAC,IAAI,CAAC,CAAE;AACtD,KAAM,CAACsB,YAAY,CAAEC,eAAe,CAAC,CAAGvB,QAAQ,CAAC,EAAE,CAAC,CACpD,KAAM,CAACwB,OAAO,CAAEC,UAAU,CAAC,CAAGzB,QAAQ,CAAC,EAAE,CAAC,CAC1C,KAAM,CAAA0B,gBAAgB,CAAGA,CAAA,GAAM,CAC3BL,cAAc,CAAEM,QAAQ,EAAK,CAACA,QAAQ,CAAC,CAC3C,CAAC,CAEL,KAAM,CAAAC,YAAY,CAAGA,CAAA,GAAM,CACvB,GAAIR,WAAW,EAAID,OAAO,CAACU,OAAO,CAACC,QAAQ,CAAC,CAAC,CAAE,CAC3C,KAAM,CAAAC,cAAc,CAAGT,YAAY,CAACU,IAAI,CACnCC,UAAU,EACPA,UAAU,CAACC,MAAM,GAAKnB,QAAQ,EAC9BkB,UAAU,CAACE,WAAW,GAAKlB,QAAQ,EACnCgB,UAAU,CAACG,MAAM,GAAK,CAC9B,CAAC,CAED,KAAM,CAAAC,aAAa,CAAGf,YAAY,CAACU,IAAI,CAClCC,UAAU,EACPA,UAAU,CAACC,MAAM,GAAKnB,QAAQ,EAC9BkB,UAAU,CAACE,WAAW,GAAKlB,QAAQ,EACnCgB,UAAU,CAACG,MAAM,GAAK,CAC9B,CAAC,CAED,KAAM,CAAAE,gBAAgB,CAAGhB,YAAY,CAACU,IAAI,CACrCC,UAAU,EACPA,UAAU,CAACC,MAAM,GAAKnB,QAAQ,EAC9BkB,UAAU,CAACE,WAAW,GAAKlB,QAAQ,EACnCgB,UAAU,CAACG,MAAM,GAAK,CAC9B,CAAC,CAED,GAAIL,cAAc,CAAE,CAChBjB,QAAQ,CAAC,SAAS,CAAC,CACvB,CAAC,IAAM,IAAIuB,aAAa,CAAE,CACtBvB,QAAQ,CAAC,UAAU,CAAC,CACxB,CAAC,IAAM,IAAGwB,gBAAgB,CAAC,CACvBxB,QAAQ,CAAC,aAAa,CAAC,CAC3B,CAAC,IAAK,CACFyB,KAAK,CAAC,mBAAmB,CAAC,CAC9B,CAGJ,CAAC,IAAO,IAAI,CAACpB,OAAO,CAACU,OAAO,CAACC,QAAQ,CAAC,CAAC,CAAE,CACrCS,KAAK,CAAC,8BAA8B,CAAC,CACzC,CAAC,IACI,CAED,KAAM,CAAAC,mBAAmB,CAAGhB,OAAO,CAACQ,IAAI,CACnCS,MAAM,EACHA,MAAM,CAACC,WAAW,GAAK3B,QAC/B,CAAC,CAED,GAAIyB,mBAAmB,CAAE,CACrB3B,kBAAkB,CAACE,QAAQ,CAAC,CAC5BD,QAAQ,CAAC,WAAW,CAAC,CACzB,CAAC,IAAM,CACHyB,KAAK,CAAC,mBAAmB,CAAC,CAC9B,CACJ,CACA,CAAC,CAED,KAAM,CAAAI,QAAQ,CAAGA,CAAA,GAAM,CACnB,GAAIxB,OAAO,CAACU,OAAO,CAACC,QAAQ,CAAC,CAAC,CAAE,CAC5Bc,OAAO,CAACC,GAAG,CAAC,kBAAkB,CAAC,CACnC,CACJ,CAAC,CAED5C,SAAS,CAAC,IAAM,CACZ,cAAe,CAAA6C,cAAcA,CAAA,CAAG,CAC5B,GAAI,CACA,KAAM,CAAAC,SAAS,CAAG,KAAM,CAAA3C,gBAAgB,CAAC,CAAC,CAC1CwC,OAAO,CAACC,GAAG,CAACE,SAAS,CAAC,CACtB,KAAM,CAAAC,oBAAoB,CAAGD,SAAS,CAACE,GAAG,CAAEC,QAAQ,GAAM,CACtDhB,MAAM,CAAEgB,QAAQ,CAAChB,MAAM,CACvBC,WAAW,CAAEe,QAAQ,CAACf,WAAW,CACjCC,MAAM,CAAEc,QAAQ,CAACd,MACrB,CAAC,CAAC,CAAC,CACHb,eAAe,CAACyB,oBAAoB,CAAC,CACrCJ,OAAO,CAACC,GAAG,CAACvB,YAAY,CAAC,CAC7B,CAAE,MAAO6B,KAAK,CAAE,CACZP,OAAO,CAACO,KAAK,CAAC,2BAA2B,CAAEA,KAAK,CAAC,CACrD,CACJ,CACAL,cAAc,CAAC,CAAC,CACpB,CAAC,CAAE,CAACxB,YAAY,CAAC,CAAC,CAElBrB,SAAS,CAAC,IAAM,CACZ,cAAe,CAAAmD,YAAYA,CAAA,CAAG,CAC1B,GAAI,CACA,KAAM,CAAAC,UAAU,CAAG,KAAM,CAAAhD,mBAAmB,CAAC,CAAC,CAC9CuC,OAAO,CAACC,GAAG,CAACQ,UAAU,CAAC,CACvB,KAAM,CAAAC,aAAa,CAAGD,UAAU,CAACJ,GAAG,CAAEM,OAAO,GAAM,CAC/Cb,WAAW,CAAEa,OAAO,CAACb,WACzB,CAAC,CAAC,CAAC,CACHjB,UAAU,CAAC6B,aAAa,CAAC,CACzBV,OAAO,CAACC,GAAG,CAACrB,OAAO,CAAC,CACxB,CAAE,MAAO2B,KAAK,CAAE,CACZP,OAAO,CAACO,KAAK,CAAC,0BAA0B,CAAEA,KAAK,CAAC,CACpD,CACJ,CACAC,YAAY,CAAC,CAAC,CAClB,CAAC,CAAE,CAAC5B,OAAO,CAAC,CAAC,CAEb,mBACIf,IAAA,YAAS+C,SAAS,CAAC,eAAe,CAAAC,QAAA,cAC9BhD,IAAA,QAAK+C,SAAS,CAAC,kBAAkB,CAAAC,QAAA,cAC7B9C,KAAA,QAAK6C,SAAS,CAAC,YAAY,CAAAC,QAAA,eACvB9C,KAAA,SAAM+C,MAAM,CAAC,GAAG,CAAAD,QAAA,eACZhD,IAAA,OAAAgD,QAAA,CAAKrC,WAAW,CAAG,gBAAgB,CAAG,UAAU,CAAK,CAAC,cACtDT,KAAA,QAAK6C,SAAS,CAAC,kBAAkB,CAAAC,QAAA,eAC7BhD,IAAA,UACIkD,IAAI,CAAC,MAAM,CACXC,KAAK,CAAE7C,QAAS,CAChB4B,QAAQ,CAAGkB,CAAC,EAAK7C,WAAW,CAAC6C,CAAC,CAACC,MAAM,CAACF,KAAK,CAAE,CAC7CG,QAAQ,MACX,CAAC,cACFtD,IAAA,UAAAgD,QAAA,CAAQrC,WAAW,CAAG,SAAS,CAAG,QAAQ,CAAQ,CAAC,EAClD,CAAC,CACLA,WAAW,eACRT,KAAA,QAAK6C,SAAS,CAAC,kBAAkB,CAAAC,QAAA,eAC7BhD,IAAA,UACIkD,IAAI,CAAC,UAAU,CACfC,KAAK,CAAE3C,QAAS,CAChB0B,QAAQ,CAAGkB,CAAC,EAAK3C,WAAW,CAAC2C,CAAC,CAACC,MAAM,CAACF,KAAK,CAAE,CAC7CG,QAAQ,MACX,CAAC,cACFtD,IAAA,UAAAgD,QAAA,CAAO,eAAU,CAAO,CAAC,EACxB,CACR,CACArC,WAAW,eACRT,KAAA,QAAK6C,SAAS,CAAC,WAAW,CAAAC,QAAA,eACtBhD,IAAA,CAACH,SAAS,EACN0D,GAAG,CAAE7C,OAAQ,CACb8C,OAAO,CAAC,0CAA0C,CAClDtB,QAAQ,CAAEA,QAAS,CACtB,CAAC,IACN,EAAK,CACR,CACAvB,WAAW,eACRX,IAAA,QAAK+C,SAAS,CAAC,SAAS,CAAAC,QAAA,cACpBhD,IAAA,MAAGyD,IAAI,CAAC,GAAG,CAAAT,QAAA,CAAC,4BAAoB,CAAG,CAAC,CACnC,CACR,EACC,CAAC,cACPhD,IAAA,QAAAgD,QAAA,cACIhD,IAAA,WAAQ+C,SAAS,CAAC,UAAU,CAACW,OAAO,CAAEvC,YAAa,CAAA6B,QAAA,CAC9CrC,WAAW,CAAG,gBAAgB,CAAG,SAAS,CACvC,CAAC,CACR,CAAC,cACNX,IAAA,QAAAgD,QAAA,cACIhD,IAAA,MAAG0D,OAAO,CAAEzC,gBAAiB,CAAC8B,SAAS,CAAC,aAAa,CAAAC,QAAA,CAChDrC,WAAW,CAAG,aAAa,CAAG,cAAc,CAC9C,CAAC,CACH,CAAC,EACL,CAAC,CACL,CAAC,CACD,CAAC,CAElB,CAEA,cAAe,CAAAR,KAAK"},"metadata":{},"sourceType":"module","externalDependencies":[]}